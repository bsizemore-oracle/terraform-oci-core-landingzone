variables:
  BUCKET_NAME: $BUCKET_NAME
  NAMESPACE: $LZTEAM_NAMESPACE
  PROXY_SERVER: $PROXY_SERVER
  TEST_CASES_ZIP: $TEST_CASES_ZIP
  PAR_LOCATION: ""

core-lz-prep-test-cases:
  stage: tf-prep-test-case
  # tags:
  #   - terraform
  # rules:
  #   - if: '$CI_PIPELINE_SOURCE == "push" || $CI_PIPELINE_SOURCE == "merge_request_event"'
  #     changes:
  #       - scripts/cis_reports.py
  script:
    - echo "  ----- BEGIN - Running Test Cases -----  "
    - export https_proxy=$PROXY_SERVER
    - oci os object get -bn $BUCKET_NAME --file $TEST_CASES_ZIP --name $TEST_CASES_ZIP -ns $LZTEAM_NAMESPACE
    - unzip $TEST_CASES_ZIP
    - export TEST_CASES_DIR=${TEST_CASES_ZIP::-4}
    - echo $TEST_CASES_DIR
    - python3 /home/gitlab-runner/pipeline-tools/preprocessor.py $TEST_CASES_DIR -f tfvars.template -d .
    - terraform fmt
    - echo "  ----- END - Running Test Cases -----  "

core-lz-run-plan-test-cases:
  stage: tf-run-test-case
  # tags:
  #   - terraform
  # rules:
  #   - if: '$CI_PIPELINE_SOURCE == "push" || $CI_PIPELINE_SOURCE == "merge_request_event"'
  #     changes:
  #       - scripts/cis_reports.py
  script:
    - echo "  ----- BEGIN - Prepping Test Cases -----  "
    - ls
    - echo "  ----- END - Prepping Test Cases -----  "